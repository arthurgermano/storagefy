import{c as M,r as mr,a as _r,b as Pe}from"./generateSimpleId.DxAnr5Wo.js";import{r as xr}from"./sleep.CSud_7jI.js";var fe={exports:{}};fe.exports;var yt;function vr(){return yt||(yt=1,function(N,A){var z=200,K="__lodash_hash_undefined__",O=9007199254740991,P="[object Arguments]",Re="[object Array]",ne="[object Boolean]",m="[object Date]",Le="[object Error]",q="[object Function]",l="[object GeneratorFunction]",R="[object Map]",o="[object Number]",L="[object Object]",se="[object Promise]",W="[object RegExp]",Y="[object Set]",$="[object String]",k="[object Symbol]",oe="[object WeakMap]",ye="[object ArrayBuffer]",j="[object DataView]",ge="[object Float32Array]",Se="[object Float64Array]",we="[object Int8Array]",V="[object Int16Array]",be="[object Int32Array]",me="[object Uint8Array]",_e="[object Uint8ClampedArray]",xe="[object Uint16Array]",X="[object Uint32Array]",je=/[\\^$.*+?()[\]{}|]/g,Fe=/\w*$/,Je=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,f={};f[P]=f[Re]=f[ye]=f[j]=f[ne]=f[m]=f[ge]=f[Se]=f[we]=f[V]=f[be]=f[R]=f[o]=f[L]=f[W]=f[Y]=f[$]=f[k]=f[me]=f[_e]=f[xe]=f[X]=!0,f[Le]=f[q]=f[oe]=!1;var Be=typeof M=="object"&&M&&M.Object===Object&&M,Q=typeof self=="object"&&self&&self.Object===Object&&self,x=Be||Q||Function("return this")(),ve=A&&!A.nodeType&&A,F=ve&&!0&&N&&!N.nodeType&&N,Ge=F&&F.exports===ve;function ce(r,n){return r.set(n[0],n[1]),r}function He(r,n){return r.add(n),r}function Ue(r,n){for(var s=-1,u=r?r.length:0;++s<u&&n(r[s],s,r)!==!1;);return r}function le(r,n){for(var s=-1,u=n.length,y=r.length;++s<u;)r[y+s]=n[s];return r}function Ee(r,n,s,u){for(var y=-1,w=r?r.length:0;++y<w;)s=n(s,r[y],y,r);return s}function Me(r,n){for(var s=-1,u=Array(r);++s<r;)u[s]=n(s);return u}function he(r,n){return r?.[n]}function de(r){var n=!1;if(r!=null&&typeof r.toString!="function")try{n=!!(r+"")}catch{}return n}function Ae(r){var n=-1,s=Array(r.size);return r.forEach(function(u,y){s[++n]=[y,u]}),s}function J(r,n){return function(s){return r(n(s))}}function Ce(r){var n=-1,s=Array(r.size);return r.forEach(function(u){s[++n]=u}),s}var _=Array.prototype,v=Function.prototype,E=Object.prototype,C=x["__core-js_shared__"],Ne=function(){var r=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),ke=v.toString,S=E.hasOwnProperty,ee=E.toString,Te=RegExp("^"+ke.call(S).replace(je,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ue=Ge?x.Buffer:void 0,pe=x.Symbol,Ie=x.Uint8Array,ze=J(Object.getPrototypeOf,Object),qe=Object.create,e=E.propertyIsEnumerable,t=_.splice,a=Object.getOwnPropertySymbols,i=ue?ue.isBuffer:void 0,c=J(Object.keys,Object),h=ae(x,"DataView"),d=ae(x,"Map"),p=ae(x,"Promise"),g=ae(x,"Set"),B=ae(x,"WeakMap"),T=ae(Object,"create"),wt=U(h),bt=U(d),mt=U(p),_t=U(g),xt=U(B),rt=pe?pe.prototype:void 0,at=rt?rt.valueOf:void 0;function G(r){var n=-1,s=r?r.length:0;for(this.clear();++n<s;){var u=r[n];this.set(u[0],u[1])}}function vt(){this.__data__=T?T(null):{}}function Et(r){return this.has(r)&&delete this.__data__[r]}function At(r){var n=this.__data__;if(T){var s=n[r];return s===K?void 0:s}return S.call(n,r)?n[r]:void 0}function Ct(r){var n=this.__data__;return T?n[r]!==void 0:S.call(n,r)}function Nt(r,n){var s=this.__data__;return s[r]=T&&n===void 0?K:n,this}G.prototype.clear=vt,G.prototype.delete=Et,G.prototype.get=At,G.prototype.has=Ct,G.prototype.set=Nt;function I(r){var n=-1,s=r?r.length:0;for(this.clear();++n<s;){var u=r[n];this.set(u[0],u[1])}}function kt(){this.__data__=[]}function Tt(r){var n=this.__data__,s=De(n,r);if(s<0)return!1;var u=n.length-1;return s==u?n.pop():t.call(n,s,1),!0}function It(r){var n=this.__data__,s=De(n,r);return s<0?void 0:n[s][1]}function Dt(r){return De(this.__data__,r)>-1}function Ot(r,n){var s=this.__data__,u=De(s,r);return u<0?s.push([r,n]):s[u][1]=n,this}I.prototype.clear=kt,I.prototype.delete=Tt,I.prototype.get=It,I.prototype.has=Dt,I.prototype.set=Ot;function te(r){var n=-1,s=r?r.length:0;for(this.clear();++n<s;){var u=r[n];this.set(u[0],u[1])}}function $t(){this.__data__={hash:new G,map:new(d||I),string:new G}}function Kt(r){return Oe(this,r).delete(r)}function Pt(r){return Oe(this,r).get(r)}function Rt(r){return Oe(this,r).has(r)}function Lt(r,n){return Oe(this,r).set(r,n),this}te.prototype.clear=$t,te.prototype.delete=Kt,te.prototype.get=Pt,te.prototype.has=Rt,te.prototype.set=Lt;function re(r){this.__data__=new I(r)}function jt(){this.__data__=new I}function Ft(r){return this.__data__.delete(r)}function Jt(r){return this.__data__.get(r)}function Bt(r){return this.__data__.has(r)}function Gt(r,n){var s=this.__data__;if(s instanceof I){var u=s.__data__;if(!d||u.length<z-1)return u.push([r,n]),this;s=this.__data__=new te(u)}return s.set(r,n),this}re.prototype.clear=jt,re.prototype.delete=Ft,re.prototype.get=Jt,re.prototype.has=Bt,re.prototype.set=Gt;function Ht(r,n){var s=Ve(r)||pr(r)?Me(r.length,String):[],u=s.length,y=!!u;for(var w in r)S.call(r,w)&&!(y&&(w=="length"||lr(w,u)))&&s.push(w);return s}function it(r,n,s){var u=r[n];(!(S.call(r,n)&&ct(u,s))||s===void 0&&!(n in r))&&(r[n]=s)}function De(r,n){for(var s=r.length;s--;)if(ct(r[s][0],n))return s;return-1}function Ut(r,n){return r&&nt(n,Xe(n),r)}function We(r,n,s,u,y,w,D){var b;if(u&&(b=w?u(r,y,w,D):u(r)),b!==void 0)return b;if(!$e(r))return r;var dt=Ve(r);if(dt){if(b=sr(r),!n)return ar(r,b)}else{var ie=H(r),ut=ie==q||ie==l;if(yr(r))return Vt(r,n);if(ie==L||ie==P||ut&&!w){if(de(r))return w?r:{};if(b=or(ut?{}:r),!n)return ir(r,Ut(b,r))}else{if(!f[ie])return w?r:{};b=cr(r,ie,We,n)}}D||(D=new re);var pt=D.get(r);if(pt)return pt;if(D.set(r,b),!dt)var ft=s?nr(r):Xe(r);return Ue(ft||r,function(Ze,Ke){ft&&(Ke=Ze,Ze=r[Ke]),it(b,Ke,We(Ze,n,s,u,Ke,r,D))}),b}function Mt(r){return $e(r)?qe(r):{}}function zt(r,n,s){var u=n(r);return Ve(r)?u:le(u,s(r))}function qt(r){return ee.call(r)}function Wt(r){if(!$e(r)||dr(r))return!1;var n=ht(r)||de(r)?Te:Je;return n.test(U(r))}function Yt(r){if(!ot(r))return c(r);var n=[];for(var s in Object(r))S.call(r,s)&&s!="constructor"&&n.push(s);return n}function Vt(r,n){if(n)return r.slice();var s=new r.constructor(r.length);return r.copy(s),s}function Ye(r){var n=new r.constructor(r.byteLength);return new Ie(n).set(new Ie(r)),n}function Xt(r,n){var s=n?Ye(r.buffer):r.buffer;return new r.constructor(s,r.byteOffset,r.byteLength)}function Zt(r,n,s){var u=n?s(Ae(r),!0):Ae(r);return Ee(u,ce,new r.constructor)}function Qt(r){var n=new r.constructor(r.source,Fe.exec(r));return n.lastIndex=r.lastIndex,n}function er(r,n,s){var u=n?s(Ce(r),!0):Ce(r);return Ee(u,He,new r.constructor)}function tr(r){return at?Object(at.call(r)):{}}function rr(r,n){var s=n?Ye(r.buffer):r.buffer;return new r.constructor(s,r.byteOffset,r.length)}function ar(r,n){var s=-1,u=r.length;for(n||(n=Array(u));++s<u;)n[s]=r[s];return n}function nt(r,n,s,u){s||(s={});for(var y=-1,w=n.length;++y<w;){var D=n[y],b=void 0;it(s,D,b===void 0?r[D]:b)}return s}function ir(r,n){return nt(r,st(r),n)}function nr(r){return zt(r,Xe,st)}function Oe(r,n){var s=r.__data__;return hr(n)?s[typeof n=="string"?"string":"hash"]:s.map}function ae(r,n){var s=he(r,n);return Wt(s)?s:void 0}var st=a?J(a,Object):wr,H=qt;(h&&H(new h(new ArrayBuffer(1)))!=j||d&&H(new d)!=R||p&&H(p.resolve())!=se||g&&H(new g)!=Y||B&&H(new B)!=oe)&&(H=function(r){var n=ee.call(r),s=n==L?r.constructor:void 0,u=s?U(s):void 0;if(u)switch(u){case wt:return j;case bt:return R;case mt:return se;case _t:return Y;case xt:return oe}return n});function sr(r){var n=r.length,s=r.constructor(n);return n&&typeof r[0]=="string"&&S.call(r,"index")&&(s.index=r.index,s.input=r.input),s}function or(r){return typeof r.constructor=="function"&&!ot(r)?Mt(ze(r)):{}}function cr(r,n,s,u){var y=r.constructor;switch(n){case ye:return Ye(r);case ne:case m:return new y(+r);case j:return Xt(r,u);case ge:case Se:case we:case V:case be:case me:case _e:case xe:case X:return rr(r,u);case R:return Zt(r,u,s);case o:case $:return new y(r);case W:return Qt(r);case Y:return er(r,u,s);case k:return tr(r)}}function lr(r,n){return n=n??O,!!n&&(typeof r=="number"||Z.test(r))&&r>-1&&r%1==0&&r<n}function hr(r){var n=typeof r;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?r!=="__proto__":r===null}function dr(r){return!!Ne&&Ne in r}function ot(r){var n=r&&r.constructor,s=typeof n=="function"&&n.prototype||E;return r===s}function U(r){if(r!=null){try{return ke.call(r)}catch{}try{return r+""}catch{}}return""}function ur(r){return We(r,!0,!0)}function ct(r,n){return r===n||r!==r&&n!==n}function pr(r){return fr(r)&&S.call(r,"callee")&&(!e.call(r,"callee")||ee.call(r)==P)}var Ve=Array.isArray;function lt(r){return r!=null&&gr(r.length)&&!ht(r)}function fr(r){return Sr(r)&&lt(r)}var yr=i||br;function ht(r){var n=$e(r)?ee.call(r):"";return n==q||n==l}function gr(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=O}function $e(r){var n=typeof r;return!!r&&(n=="object"||n=="function")}function Sr(r){return!!r&&typeof r=="object"}function Xe(r){return lt(r)?Ht(r):Yt(r)}function wr(){return[]}function br(){return!1}N.exports=ur}(fe,fe.exports)),fe.exports}var Qe,gt;function et(){if(gt)return Qe;gt=1;const N=vr();function A(z={},K={},O=!0){if(typeof z!="object"){if(O)throw new Error("Assign Function: The target provided is not an object");return null}if(typeof K!="object"){if(O)throw new Error("Assign Function: The source provided is not an object");return null}try{return Object.assign(N(z),N(K))}catch(P){if(O)throw P}}return Qe=A,Qe}var tt,St;function Er(){if(St)return tt;St=1;var N=Object.create,A=Object.defineProperty,z=Object.getOwnPropertyDescriptor,K=Object.getOwnPropertyNames,O=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty,Re=(e,t)=>{for(var a in t)A(e,a,{get:t[a],enumerable:!0})},ne=(e,t,a,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let c of K(t))!P.call(e,c)&&c!==a&&A(e,c,{get:()=>t[c],enumerable:!(i=z(t,c))||i.enumerable});return e},m=(e,t,a)=>(a=e!=null?N(O(e)):{},ne(A(a,"default",{value:e,enumerable:!0}),e)),Le=e=>ne(A({},"__esModule",{value:!0}),e),q={};Re(q,{IndexedDBAdapter:()=>Z,LocalStorageAdapter:()=>Q,PiniaAdapter:()=>le,ReactAdapter:()=>he,SessionStorageAdapter:()=>F,SvelteAdapter:()=>J,getPiniaAdapter:()=>Te,getReactAdapter:()=>ue,getStorageAdapter:()=>ke,getSvelteAdapter:()=>pe,setPiniaStorage:()=>Ie,setReactStorage:()=>ze,setSvelteStorage:()=>qe,startStoragefy:()=>Ne}),tt=Le(q),globalThis.storagefyDebug=!0,globalThis.storagefyDebugLevel=0;var l=(...e)=>{globalThis.storagefyDebug&&globalThis.storagefyDebugLevel>=0&&(e.unshift("Storagefy Error:"),console.error(...e))},R=(...e)=>{globalThis.storagefyDebug&&globalThis.storagefyDebugLevel>=1&&(e.unshift("Storagefy Warn:"),console.warn(...e))},o=(...e)=>{globalThis.storagefyDebug&&globalThis.storagefyDebugLevel>=2&&(e.unshift("Storagefy:"),console.info(...e))},L=m(mr()),se=m(_r()),W=new TextEncoder,Y=new TextDecoder,$,k;function oe(){try{if(o("CryptoHelper - Attempting to initialize crypto engine"),typeof window<"u"&&window.crypto){$=window.crypto,k=$.subtle,o("CryptoHelper - Crypto initialized from window.crypto");return}if(typeof M<"u"&&M.crypto?.webcrypto){$=M.crypto.webcrypto,k=$.subtle,o("CryptoHelper - Crypto initialized from global.webcrypto");return}throw new Error("Crypto API not available")}catch(e){throw l("Failed to initialize crypto:",e),e}}try{oe()}catch(e){l("Failed to initialize crypto:",e)}var ye=async e=>{try{return o("CryptoHelper - Generating key material from password"),k.importKey("raw",W.encode(e),"PBKDF2",!1,["deriveKey"])}catch(t){throw l("Error generating key material:",t),t}},j=async(e,t,a=!1)=>{try{if(typeof e!="string"||!e.length)throw new Error("Invalid password");o("CryptoHelper - Deriving key with PBKDF2",{passwordLength:e.length,extractable:a});let i=await ye(e);return k.deriveKey({name:"PBKDF2",salt:W.encode(t),iterations:1e5,hash:"SHA-256"},i,{name:"AES-GCM",length:256},a,["encrypt","decrypt"])}catch(i){throw l("Error deriving key:",i),i}},ge=async(e,t,a=!1)=>{if(t===void 0||typeof t=="function"||typeof t=="symbol")throw new Error("Invalid data type for encryption");try{o("CryptoHelper - Encrypting data",{raw:a});let i=$.getRandomValues(new Uint8Array(12)),c=W.encode(JSON.stringify(t)),h=await k.encrypt({name:"AES-GCM",iv:i},e,c);if(a)return{iv:i,data:new Uint8Array(h)};let d=(0,L.default)(String.fromCharCode(...i)),p=(0,L.default)(String.fromCharCode(...new Uint8Array(h)));return{iv:d,data:p}}catch(i){throw l("Error encrypting data:",i),i}},Se=async(e,t,a=!1)=>{let i,c;try{if(o("CryptoHelper - Decrypting data",{raw:a}),a)i=new Uint8Array(t.iv),c=new Uint8Array(t.data);else{let d=p=>new Uint8Array((0,se.default)(p).split("").map(g=>g.charCodeAt(0)));i=d(t.iv),c=d(t.data)}let h=await k.decrypt({name:"AES-GCM",iv:i},e,c);return JSON.parse(Y.decode(h))}catch(h){throw l("Error decrypting data:",h),h}};function we(e){if(!e)return e;o("CryptoHelper - Obfuscating string");try{let t=[...e].map(a=>String.fromCharCode(a.charCodeAt(0)+1)).join("");return(0,L.default)(t)}catch{return e}}function V(e){if(!e)return e;o("CryptoHelper - Deobfuscating string");try{return[...(0,se.default)(e)].map(t=>String.fromCharCode(t.charCodeAt(0)-1)).join("")}catch{return e}}var be=m(Pe()),me=class{constructor(e){try{typeof e!="string"&&(e=(0,be.default)("storagefy_channel")),this.channel=new BroadcastChannel(e),this.channelName=e,o(`CrossTabChannel initialized on channel "${e}"`)}catch(t){throw l("Failed to initialize BroadcastChannel:",t),t}}subscribe(e){if(typeof e!="function"){R("CrossTabChannel.subscribe: Provided callback is not a function.");return}this.channel.onmessage=t=>{o("CrossTabChannel - Received message:",t.data);try{e(t.data)}catch(a){l("Error in CrossTabChannel subscriber callback:",a)}},o("CrossTabChannel - Subscribed to incoming messages.")}emit(e){try{this.channel.postMessage(e),o("CrossTabChannel - Emitted message:",e)}catch(t){l("CrossTabChannel.emit: Failed to send message:",t)}}close(){try{this.channel.close(),o("CrossTabChannel - Channel closed.")}catch(e){l("CrossTabChannel.close: Error closing channel:",e)}}},_e=me,xe=class{constructor(e){e?(o("StorageAdapter - Initializing cross-tab channel:",e),this.channelName=e,this.channel=new _e(e)):(this.channel=null,this.channelName=null,R("StorageAdapter - No channel name provided, cross-tab syncing disabled."))}async get(e){throw new Error("Not implemented")}async set(e,t,a){throw new Error("Not implemented")}async delete(e){throw new Error("Not implemented")}async list(e=""){throw new Error("Not implemented")}async reset(){throw new Error("Not implemented")}async clear(){throw new Error("Not implemented")}async clearExpire(){throw new Error("Not implemented")}async setExpire(e,t){throw new Error("Not implemented")}async deleteExpire(e){throw new Error("Not implemented")}async has(e){throw new Error("Not implemented")}async _encrypt(e,t){if(!this.encrypt||!e)return t;try{let a=await j(e),i=await ge(a,t,!1);return o(`StorageAdapter - Successfully encrypted value for key "${e}".`),JSON.stringify(i)}catch(a){return l("Encryption failed:",a),null}}async _decrypt(e,t){if(!this.encrypt||!e)return JSON.parse(t);try{let a=await j(e),i=JSON.parse(t),c=await Se(a,i,!1);return o(`StorageAdapter - Successfully decrypted value for key "${e}".`),JSON.parse(c)}catch(a){return l("Decryption failed:",a),null}}_fullKey(e){let t=`${this.prefix}${e}`;if(this.encrypt){let a=we(t);return o(`StorageAdapter - Obfuscated key "${e}" to "${a}".`),a}return o(`StorageAdapter - Using plain key: "${t}"`),t}_startExpireWatcher(){this._expireTimer&&clearInterval(this._expireTimer),!(this.expireCheckInterval<=0)&&(this._expireTimer=setInterval(()=>{try{o("StorageAdapter - Running expiration cleanup..."),this.clearExpire()}catch(e){l("Error clearing expired keys:",e)}},this.expireCheckInterval),o(`StorageAdapter - Expire watcher started, interval: ${this.expireCheckInterval}ms`))}destroy(){this._expireTimer&&(clearInterval(this._expireTimer),this._expireTimer=null,o("StorageAdapter - Expire watcher stopped.")),this._unloadHandler&&(window.removeEventListener("beforeunload",this._unloadHandler),this._unloadHandler=null,o("StorageAdapter - Removed unload handler."))}async getAll(e){return o(`StorageAdapter - Getting all keys under table: "${e}"`),this.list(`${e}__`)}async getExpire(e){try{let t=await this._loadExpires();return o(`StorageAdapter - Getting expiration for key "${e}":`,t[e]||null),t[e]||null}catch(t){return l(`Error getting expire for key '${e}':`,t),null}}emitDataChange(e,t,a){!this.channelName||!a||(o(`StorageAdapter - Emitting data change for key "${e}" from origin "${a}"`),this.channel.emit({adapterId:this.adapterId,key:e,value:t,origin:a}))}onDataChanged(e){!this.channelName||typeof e!="function"||(o("StorageAdapter - Subscribing to cross-tab data changes."),this.channel.subscribe(e))}},X=xe,je=m(xr()),Fe=m(Pe()),Je=class extends X{constructor({dbName:e,storeName:t,version:a=1,encrypt:i=!1,expireCheckInterval:c=1e3,channelName:h=!1,enableSyncTabs:d=!1,description:p=""}){if(super(h),typeof indexedDB>"u")throw l("IndexedDB is not available in this environment"),new Error("IndexedDB is not available in this environment");this.isReady=!1,this.dbName=e,this.storeName=t||`${e}_store`,this.encrypt=i,this.expireKey=`STRGF_${e}__expires`,this.metaKey=`STRGF_${e}__meta`,this.prefix=`${e}__`,this.adapterId=(0,Fe.default)(e),this.enableSyncTabs=d||!1,this.expireCheckInterval=c,this.dbPromise=null,this._initDB({dbName:e,version:a,description:p}),this._startExpireWatcher(),this._unloadHandler=()=>this.destroy(),window.addEventListener("beforeunload",this._unloadHandler),o(`IndexedDBAdapter - initialized with dbName: ${e}, storeName: ${this.storeName}`)}_initDB({dbName:e,version:t,description:a}){o(`IndexedDBAdapter -Initializing IndexedDB with dbName: ${e}, storeName: ${this.storeName}`),this.dbPromise=new Promise((i,c)=>{let h=indexedDB.open(e,t);h.onupgradeneeded=d=>{let p=d.target.result;p.objectStoreNames.contains(this.storeName)||p.createObjectStore(this.storeName);let g={dbName:e,version:t,description:a,createdAt:Date.now()};d.target.transaction.objectStore(this.storeName).put(JSON.stringify(g),this.metaKey)},h.onsuccess=d=>{let p=d.target.result,g=p.transaction(this.storeName,"readwrite").objectStore(this.storeName),B=g.get(this.metaKey);B.onsuccess=()=>{if(!B.result){let T={dbName:e,version:t,description:a,createdAt:Date.now()};g.put(JSON.stringify(T),this.metaKey)}this.isReady=!0,i(p)},B.onerror=T=>{l("Error checking meta:",T),i(p)}},h.onerror=d=>{l("Error opening database:",d.target.error),c(d.target.error)}})}async waitReadiness(e=50,t=20){return o(`IndexedDBAdapter - Waiting for database readiness with timeout: ${e}ms, tries: ${t}`),new Promise(async(a,i)=>{let c=0;for(;!this.isReady&&c++<=t;){if(this.isReady)return a(),!0;await(0,je.default)(e)}if(this.isReady)return a(),!0;i(new Error("Database is not ready"))})}async _withStore(e,t){try{o(`IndexedDBAdapter - Executing operation in ${e} mode`);let a=(await this.dbPromise).transaction(this.storeName,e).objectStore(this.storeName);return await t(a)}catch(a){throw l("Database operation failed:",a),a}}async _loadExpires(){return o("IndexedDBAdapter - Loading expiration timestamps"),this._withStore("readonly",async e=>new Promise(t=>{let a=e.get(this.expireKey);a.onsuccess=()=>{t(a.result?JSON.parse(a.result):{})},a.onerror=()=>{t({})}}))}async get(e){try{o(`IndexedDBAdapter - Getting key: ${e}`);let t=this._fullKey(e),a=await this._withStore("readonly",c=>new Promise(h=>{let d=c.get(t);d.onsuccess=()=>h(d.result),d.onerror=()=>h(null)}));if(!a)return null;let i=await this.getExpire(e);return i&&Date.now()>=i?(await this.delete(e),null):await this._decrypt(e,a)}catch(t){return l(`Error getting key '${e}':`,t),null}}async set(e,t,a){try{if(o(`IndexedDBAdapter - Setting key: ${e}`,{value:t,expire:a}),!e&&!t)return!1;let i=this._fullKey(e);if(e&&t==null)return await this.delete(i),null;t=JSON.stringify(t);let c=await this._encrypt(e,t);return c?(await this._withStore("readwrite",h=>new Promise(d=>{let p=h.put(c,i);p.onsuccess=()=>{this.enableSyncTabs&&this.emitDataChange(e,void 0,"reset"),d(!0)},p.onerror=()=>d(!1)})),typeof a!="number"?(await this.deleteExpire(e),!0):a>0?(await this.setExpire(e,Date.now()+a),!0):(await this.delete(e),null)):!1}catch(i){return l(`Error setting key '${e}':`,i),!1}}async delete(e){try{o(`IndexedDBAdapter - Deleting key: ${e}`);let t=this._fullKey(e);await this._withStore("readwrite",i=>new Promise(c=>{let h=i.delete(t);h.onsuccess=()=>{this.enableSyncTabs&&this.emitDataChange(e,void 0,"reset"),c(!0)},h.onerror=()=>c()}));let a=await this._loadExpires();delete a[e],await this._withStore("readwrite",i=>new Promise(c=>{let h=i.put(JSON.stringify(a),this.expireKey);h.onsuccess=()=>c(),h.onerror=()=>c()}))}catch(t){l(`Error deleting key '${e}':`,t)}}async list(){let e=[];try{o(`IndexedDBAdapter - Listing keys with prefix: ${this.prefix}`),await this._withStore("readonly",async t=>new Promise(a=>{let i=t.getAllKeys();i.onsuccess=async()=>{let c=i.result||[];for(let h of c)if(this.encrypt&&(h=V(h)),!(h===this.metaKey||h===this.expireKey)&&h.startsWith(this.prefix)){let d=await this.get(h.replace(this.prefix,""));d!==null&&e.push({key:h.replace(this.prefix,""),value:d})}a()},i.onerror=()=>a()}))}catch(t){l("Error listing keys:",t)}return e}async has(e){try{o(`IndexedDBAdapter - Checking existence of key: ${e}`);let t=this._fullKey(e);return await this._withStore("readonly",a=>new Promise(i=>{let c=a.getKey(t);c.onsuccess=()=>i(c.result!==void 0),c.onerror=()=>i(!1)}))}catch(t){return l(`Error checking key '${e}':`,t),!1}}async clear(){try{o("IndexedDBAdapter - Clearing all data"),await this.reset(),await this._withStore("readwrite",e=>new Promise(t=>{let a=e.delete(this.metaKey);a.onsuccess=()=>{let i=e.delete(this.expireKey);i.onsuccess=()=>t(),i.onerror=()=>t()},a.onerror=()=>t()}))}catch(e){l("Error clearing storage:",e)}}async reset(){try{o("IndexedDBAdapter - Resetting storage"),await this._withStore("readwrite",async e=>new Promise(t=>{let a=e.getAllKeys();a.onsuccess=()=>{let i=a.result||[];if(i.length===0){t();return}let c=0,h=d=>()=>{++c===i.length&&(this.enableSyncTabs&&this.emitDataChange(d.replace(this.prefix,""),"reset"),t())};for(let d of i){let p=e.delete(d);p.onsuccess=h(d),p.onerror=h(d)}},a.onerror=()=>t()}))}catch(e){l("Error resetting storage:",e)}}async setExpire(e,t){try{o(`IndexedDBAdapter - Setting expire for key: ${e}, timestamp: ${t}`);let a=await this._loadExpires();a[e]=t,await this._withStore("readwrite",i=>new Promise(c=>{let h=i.put(JSON.stringify(a),this.expireKey);h.onsuccess=()=>c(),h.onerror=()=>c()}))}catch(a){l(`Error setting expire for key '${e}':`,a)}}async deleteExpire(e){try{o(`IndexedDBAdapter - Deleting expire for key: ${e}`);let t=await this._loadExpires();delete t[e],await this._withStore("readwrite",a=>new Promise(i=>{let c=a.put(JSON.stringify(t),this.expireKey);c.onsuccess=()=>i(),c.onerror=()=>i()}))}catch(t){l(`Error deleting expire for key '${e}':`,t)}}async clearExpire(){try{o("IndexedDBAdapter - Clearing expired keys");let e=Date.now(),t=await this._loadExpires(),a=!1;for(let i in t)t[i]<=e&&(await this.delete(i),a=!0);if(a){let i=await this._loadExpires();await this._withStore("readwrite",c=>new Promise(h=>{let d=c.put(JSON.stringify(i),this.expireKey);d.onsuccess=()=>h(),d.onerror=()=>h()}))}}catch(e){l("Error clearing expired keys:",e)}}},Z=Je,f=m(Pe()),Be=class extends X{constructor({dbName:e,version:t=1,encrypt:a=!1,expireCheckInterval:i=1e3,description:c="",channelName:h=!1,enableSyncTabs:d=!1}){if(super(h),typeof localStorage>"u")throw l("LocalStorage is not available in this environment"),new Error("LocalStorage is not available in this environment");this.dbName=e,this.encrypt=a,this.expireKey=`STRGF_${e}__expires`,this.metaKey=`STRGF_${e}__meta`,this.prefix=`${e}__`,this.adapterId=(0,f.default)(e),this.expireCheckInterval=i,this.enableSyncTabs=d||!1,this._initMeta({dbName:e,version:t,description:c}),this._startExpireWatcher(),this._unloadHandler=()=>this.destroy(),window.addEventListener("beforeunload",this._unloadHandler),o(`LocalStorageAdapter -  initialized with dbName: ${e}, version: ${t}, encrypt: ${a}, description: ${c}`)}_initMeta({dbName:e,version:t,description:a}){try{o("LocalStorageAdapter - Initializing metadata for LocalStorageAdapter");let i={dbName:e,version:t,description:a,createdAt:Date.now()};localStorage.setItem(this.metaKey,JSON.stringify(i))}catch(i){l("Error initializing meta:",i)}}_loadExpires(){try{o("LocalStorageAdapter - Loading expiration metadata");let e=localStorage.getItem(this.expireKey);return e?JSON.parse(e):{}}catch(e){return l("Error loading expires:",e),{}}}async get(e){try{o(`LocalStorageAdapter - Getting key: ${e}`);let t=this._fullKey(e),a=localStorage.getItem(t);if(!a)return null;let i=await this.getExpire(e);return i&&Date.now()>=i?(await this.delete(e),null):await this._decrypt(e,a)}catch(t){return l(`Error getting key '${e}':`,t),null}}async set(e,t,a){try{if(o(`LocalStorageAdapter - Setting key: ${e}`,{value:t,expire:a}),!e&&!t)return!1;let i=this._fullKey(e);if(e&&t==null)return await this.delete(i),null;t=JSON.stringify(t);let c=await this._encrypt(e,t);return c?(localStorage.setItem(i,c),this.enableSyncTabs&&this.emitDataChange(e,void 0,"set"),typeof a!="number"?(await this.deleteExpire(e),!0):a>0?(await this.setExpire(e,Date.now()+a),!0):(await this.delete(e),null)):!1}catch(i){return l(`Error setting key '${e}':`,i),!1}}async delete(e){try{o(`LocalStorageAdapter - Deleting key: ${e}`);let t=this._fullKey(e);localStorage.removeItem(t);let a=this._loadExpires();delete a[e],localStorage.setItem(this.expireKey,JSON.stringify(a)),this.enableSyncTabs&&this.emitDataChange(e,void 0,"delete")}catch(t){l(`Error deleting key '${e}':`,t)}}async list(){let e=[];o(`LocalStorageAdapter - Listing keys with prefix: ${this.prefix}`);try{for(let t=0;t<localStorage.length;t++){let a=localStorage.key(t);if(this.encrypt&&(a=V(a)),!(a===this.metaKey||a===this.expireKey)&&a.startsWith(this.prefix)){let i=await this.get(a.replace(this.prefix,""));i!==null&&e.push({key:a.replace(this.prefix,""),value:i})}}}catch(t){throw l("Error listing keys:",t),t}return e}async has(e){try{o(`LocalStorageAdapter - Checking existence of key: ${e}`);let t=this._fullKey(e);return localStorage.getItem(t)!==null}catch(t){return l(`Error checking key '${e}':`,t),!1}}async clear(){try{o("LocalStorageAdapter - Clearing all data"),await this.reset(),localStorage.removeItem(this.metaKey),localStorage.removeItem(this.expireKey)}catch(e){l("Error clearing storage:",e)}}async reset(){try{o("LocalStorageAdapter - Resetting storage");let e=[];for(let t=0;t<localStorage.length;t++){let a=localStorage.key(t);a.startsWith(this.prefix)&&e.push(a)}for(let t of e)localStorage.removeItem(t),this.enableSyncTabs&&this.emitDataChange(t.replace(this.prefix,""),void 0,"reset")}catch(e){l("Error resetting storage:",e)}}async setExpire(e,t){try{o(`LocalStorageAdapter - Setting expiration for key: ${e}`,{timestamp:t});let a=this._loadExpires();a[e]=t,localStorage.setItem(this.expireKey,JSON.stringify(a))}catch(a){l(`Error setting expire for key '${e}':`,a)}}async deleteExpire(e){try{o(`LocalStorageAdapter - Deleting expiration for key: ${e}`);let t=this._loadExpires();delete t[e],localStorage.setItem(this.expireKey,JSON.stringify(t))}catch(t){l(`Error deleting expire for key '${e}':`,t)}}async clearExpire(){try{o("LocalStorageAdapter - Clearing expired keys");let e=Date.now(),t=this._loadExpires(),a=!1;for(let i in t)t[i]<=e&&(await this.delete(i),a=!0);a&&localStorage.setItem(this.expireKey,JSON.stringify(this._loadExpires()))}catch(e){l("Error clearing expired keys:",e)}}},Q=Be,x=m(Pe()),ve=class extends X{constructor({dbName:e,version:t=1,encrypt:a=!1,expireCheckInterval:i=1e3,channelName:c=!1,description:h="",enableSyncTabs:d=!1}){if(super(c),typeof sessionStorage>"u")throw l("SessionStorage is not available in this environment"),new Error("SessionStorage is not available in this environment");this.dbName=e,this.encrypt=a,this.expireKey=`STRGF_${e}__expires`,this.metaKey=`STRGF_${e}__meta`,this.prefix=`${e}__`,this.adapterId=(0,x.default)(e),this.expireCheckInterval=i,this.enableSyncTabs=d||!1,this._initMeta({dbName:e,version:t,description:h}),this._startExpireWatcher(),this._unloadHandler=()=>this.destroy(),window.addEventListener("beforeunload",this._unloadHandler),o(`SessionStorageAdapter - initialized with prefix: ${this.prefix}, encrypt: ${this.encrypt}`)}_initMeta({dbName:e,version:t,description:a}){try{o(`SessionStorageAdapter - Initializing metadata for ${e} v${t}`);let i={dbName:e,version:t,description:a,createdAt:Date.now()};sessionStorage.setItem(this.metaKey,JSON.stringify(i))}catch(i){l("Error initializing meta:",i)}}_loadExpires(){try{o("SessionStorageAdapter - Loading expiration map");let e=sessionStorage.getItem(this.expireKey);return e?JSON.parse(e):{}}catch(e){return l("Error loading expires:",e),{}}}async get(e){try{o(`SessionStorageAdapter - Getting key '${e}'`);let t=this._fullKey(e),a=sessionStorage.getItem(t);if(!a)return null;let i=await this.getExpire(e);return i&&Date.now()>=i?(await this.delete(e),null):await this._decrypt(e,a)}catch(t){return l(`Error getting key '${e}':`,t),null}}async set(e,t,a){try{if(o(`SessionStorageAdapter - Setting key: ${e}`,{value:t,expire:a}),!e&&!t)return!1;let i=this._fullKey(e);if(e&&t==null)return await this.delete(i),null;t=JSON.stringify(t);let c=await this._encrypt(e,t);return c?(sessionStorage.setItem(i,c),this.enableSyncTabs&&this.emitDataChange(e,c,"set"),typeof a!="number"?(await this.deleteExpire(e),!0):a>0?(await this.setExpire(e,Date.now()+a),!0):(await this.delete(e),null)):!1}catch(i){return l(`Error setting key '${e}':`,i),!1}}async delete(e){try{o(`SessionStorageAdapter - Deleting key '${e}'`);let t=this._fullKey(e);sessionStorage.removeItem(t);let a=this._loadExpires();delete a[e],sessionStorage.setItem(this.expireKey,JSON.stringify(a)),this.enableSyncTabs&&this.emitDataChange(e,void 0,"delete")}catch(t){l(`Error deleting key '${e}':`,t)}}async list(){let e=[];try{o(`SessionStorageAdapter - Listing keys with prefix '${this.prefix}'`);for(let t=0;t<sessionStorage.length;t++){let a=sessionStorage.key(t);if(this.encrypt&&(a=V(a)),!(a===this.metaKey||a===this.expireKey)&&a.startsWith(this.prefix)){let i=await this.get(a.replace(this.prefix,""));i!==null&&e.push({key:a.replace(this.prefix,""),value:i})}}}catch(t){throw l("Error listing keys:",t),t}return e}async has(e){try{o(`SessionStorageAdapter - Checking existence of key '${e}'`);let t=this._fullKey(e);return sessionStorage.getItem(t)!==null}catch(t){return l(`Error checking key '${e}':`,t),!1}}async clear(){try{o("SessionStorageAdapter - Clearing all data"),await this.reset(),sessionStorage.removeItem(this.metaKey),sessionStorage.removeItem(this.expireKey)}catch(e){l("Error clearing storage:",e)}}async reset(){try{o("SessionStorageAdapter - Resetting storage");let e=[];for(let t=0;t<sessionStorage.length;t++){let a=sessionStorage.key(t);a.startsWith(this.prefix)&&e.push(a)}for(let t of e)sessionStorage.removeItem(t),this.enableSyncTabs&&this.emitDataChange(t.replace(this.prefix,""),void 0,"reset")}catch(e){l("Error resetting storage:",e)}}async setExpire(e,t){try{o(`SessionStorageAdapter - Setting expire for key '${e}'`);let a=this._loadExpires();a[e]=t,sessionStorage.setItem(this.expireKey,JSON.stringify(a))}catch(a){l(`Error setting expire for key '${e}':`,a)}}async deleteExpire(e){try{o(`SessionStorageAdapter - Deleting expire for key '${e}'`);let t=this._loadExpires();delete t[e],sessionStorage.setItem(this.expireKey,JSON.stringify(t))}catch(t){l(`Error deleting expire for key '${e}':`,t)}}async clearExpire(){try{o("SessionStorageAdapter - Clearing expired keys");let e=Date.now(),t=this._loadExpires(),a=!1;for(let i in t)t[i]<=e&&(await this.delete(i),a=!0);a&&sessionStorage.setItem(this.expireKey,JSON.stringify(this._loadExpires()))}catch(e){l("Error clearing expired keys:",e)}}},F=ve,Ge=class{async setInStorage(e,t,a={}){throw new Error("Not implemented")}async getFromStorage(e,t,a){throw new Error("Not implemented")}destroy(e){if(this.stores&&this.stores[e]&&typeof this.stores[e].unsubscribe=="function"){o("StoreAdapter - destroy - Unsubscribing from store changes."),this.stores[e].unsubscribe,delete this.stores[e];return}o("StoreAdapter - destroy - No unsubscribe function to call.")}},ce=Ge,He=m(et()),Ue=class extends ce{constructor(e){if(super(),!e)throw l("Adapter provided is not defined"),new Error("Adapter provided is not defined");this.adapter=e,this.stores={}}_checkStore(e){if(!e||!e.$subscribe||!e.$patch)throw l("Store provided is not defined"),new Error("Store provided is not defined")}_registerOnDataChanged(e){o("PiniaAdapter - Registering onDataChanged listener"),!(!e||!this.stores||!this.stores[e])&&this.adapter.onDataChanged(async t=>{try{if(t.adapterId==this.adapter.adapterId||!t.origin||!this.stores||!this.stores[t.key]||!this.stores[t.key].store)return;let a;if(t.value?a=await this.adapter._decrypt(t.key,t.value):a=await this.adapter.get(t.key),JSON.stringify(!this.stores[t.key].store.$state)===JSON.stringify(a))return;this.stores[t.key].store.$state={...this.stores[t.key].store.$state,...a,STORAGEFY_SILENT_CHANNEL_UPDATE:!0}}catch(a){l("PiniaAdapter - onDataChanged - error:",a)}})}async setInStorage(e,t,a={}){try{return o("PiniaAdapter - setInStorage - key:",t),this._checkStore(e),a.ignoreKeys=a.ignoreKeys||[],this.stores[t]&&this.stores[t].unsubscribe&&typeof this.stores[t].unsubscribe=="function"&&this.stores[t].unsubscribe(),delete this.stores[t],this.stores[t]={key:t,options:a,store:e,unsubscribe:null},new Promise((i,c)=>{this.stores[t].unsubscribe=e.$subscribe(async(h,d)=>{try{if(!d)return i(!0);if(d.STORAGEFY_SILENT_CHANNEL_UPDATE)return delete d.STORAGEFY_SILENT_CHANNEL_UPDATE,i(!0);let p={...d};for(let g in p)a.ignoreKeys.includes(g)&&(p[g]=void 0);return await this.adapter.set(t,p,a.timeout),i(!0)}catch(p){return c(p)}}),e.$patch({...e.$state}),a.syncTabs&&this._registerOnDataChanged(t)})}catch(i){throw l(i),i}}async getFromStorage(e,t){try{o("PiniaAdapter - getFromStorage - key:",t),this._checkStore(e);let a=await this.adapter.get(t);return a?(e.$patch((0,He.default)({},a)),!0):void 0}catch(a){throw l(a),a}}},le=Ue,Ee=m(et()),Me=class extends ce{constructor(e){if(super(),!e)throw l("Adapter provided is not defined"),new Error("Adapter provided is not defined");this.adapter=e,this.stores={}}_getPayload(e,t){return{...e,...t,STORAGEFY_SILENT_CHANNEL_UPDATE:!0}}_registerOnDataChanged(e){!e||!this.stores||!this.stores[e]||(o("ReactAdapter - Registering onDataChanged listener"),this.adapter.onDataChanged(async t=>{try{if(t.adapterId==this.adapter.adapterId||!t.origin||!this.stores||!this.stores[t.key]||!this.stores[t.key].store)return;let a=this.stores[t.key].store,i;if(t.value?i=await this.adapter._decrypt(t.key,t.value):i=await this.adapter.get(t.key),typeof a.dispatch=="function"&&typeof a.getState=="function"){let h=a.getState();if(JSON.stringify(h)===JSON.stringify(i))return;a.dispatch({type:"STORAGEFY_UPDATE",payload:this._getPayload(h,i)});return}if(typeof a.getState=="function"&&typeof a.setState=="function"){let h=a.getState();if(JSON.stringify(h)===JSON.stringify(i))return;a.setState(this._getPayload(h,i));return}if(typeof a.set=="function"&&typeof a.get=="function"){let h=a.get();if(JSON.stringify(h)===JSON.stringify(i))return;a.set(this._getPayload(h,i));return}if(typeof a.update=="function"){a.update(h=>JSON.stringify(h)===JSON.stringify(i)?h:this._getPayload(h,i));return}let c=typeof a.getState=="function"?a.getState():typeof a.get=="function"?a.get():{};if(JSON.stringify(c)===JSON.stringify(i))return;typeof a.set=="function"?a.set(this._getPayload(c,i)):l("Unable to update store: No compatible update method found")}catch(a){l("Error in _registerOnDataChanged:",a)}}))}async setInStorage(e,t,a={}){try{return o("ReactAdapter - setInStorage - key:",t),this._checkStore(e),a.ignoreKeys=a.ignoreKeys||[],this.stores[t]&&this.stores[t].unsubscribe&&typeof this.stores[t].unsubscribe=="function"&&this.stores[t].unsubscribe(),delete this.stores[t],this.stores[t]={key:t,options:a,store:e,unsubscribe:null},new Promise((i,c)=>{let h=async d=>{try{if(!d)return;if(d.STORAGEFY_SILENT_CHANNEL_UPDATE)return delete d.STORAGEFY_SILENT_CHANNEL_UPDATE,i(!0);let p={...d};for(let g in p)a.ignoreKeys.includes(g)&&(p[g]=void 0);await this.adapter.set(t,p,a.timeout)}catch(p){l(p)}};if(typeof e.subscribe=="function"&&typeof e.getState=="function")h(e.getState()),this.stores[t].unsubscribe=e.subscribe(()=>{h(e.getState())});else if(typeof e.subscribe=="function")this.stores[t].unsubscribe=e.subscribe(h);else{c(new Error("Unsupported store type"));return}a.syncTabs&&this._registerOnDataChanged(t),i(!0)})}catch(i){throw l(i),i}}async getFromStorage(e,t){try{o("ReactAdapter - getFromStorage - key:",t),this._checkStore(e);let a=await this.adapter.get(t);if(!a)return;if(typeof e.dispatch=="function")e.dispatch({type:"SET_STATE_FROM_STORAGE",payload:a});else if(typeof e.setState=="function")e.setState((0,Ee.default)({},a));else throw new Error("Cannot update store: setState or dispatch method not found");return!0}catch(a){throw l(a),a}}_checkStore(e){if(!e)throw l("Store provided is not defined"),new Error("Store provided is not defined");if(typeof e.getState=="function"&&typeof e.dispatch=="function"&&typeof e.subscribe=="function"||typeof e.getState=="function"&&typeof e.setState=="function"&&typeof e.subscribe=="function"||Array.isArray(e)&&e.length===2&&typeof e[0]=="function"&&typeof e[1]=="function")return;let t=typeof e.getState=="function"||typeof e._getState=="function",a=typeof e.setState=="function"||typeof e._setState=="function";if(typeof e.subscribe!="function")throw l("Store must have a subscribe method"),new Error("Store must have a subscribe method");if(!t&&!a)throw l("Store must have either getState/setState or _getState/_setState methods"),new Error("Store must have either getState/setState or _getState/_setState methods")}},he=Me,de=m(et()),Ae=class extends ce{constructor(e){if(super(),!e)throw l("Adapter provided is not defined"),new Error("Adapter provided is not defined");this.adapter=e,this.stores={}}_registerOnDataChanged(e){if(o("SvelteAdapter - Registering onDataChanged listener"),!(!e||!this.stores||!this.stores[e]))try{if(!store)return;this.adapter.onDataChanged(async t=>{if(t.adapterId==this.adapter.adapterId||!t.origin||!this.stores||!this.stores[t.key]||!this.stores[t.key].store)return;let a;this.stores[t.key].store.subscribe(c=>{a=(0,de.default)({},c)})();let i;t.value?i=await this.adapter._decrypt(t.key,t.value):i=await this.adapter.get(t.key),JSON.stringify(a)!==JSON.stringify(i)&&this.stores[t.key].store.update(c=>({...c,...i,STORAGEFY_SILENT_CHANNEL_UPDATE:!0}))})}catch(t){throw l("SvelteAdapter - onDataChanged error:",t),t}}async setInStorage(e,t,a={}){try{return o("SvelteAdapter - setInStorage - key:",t),this._checkStore(e),a.ignoreKeys=a.ignoreKeys||[],this.stores[t]&&this.stores[t].unsubscribe&&typeof this.stores[t].unsubscribe=="function"&&this.stores[t].unsubscribe(),delete this.stores[t],this.stores[t]={key:t,options:a,store:e,unsubscribe:null},new Promise((i,c)=>{this.stores[t].unsubscribe=e.subscribe(async h=>{try{if(!h)return i(!0);let d={...h};for(let p in d)a.ignoreKeys.includes(p)&&(d[p]=void 0);return await this.adapter.set(t,d,a.timeout),i(!0)}catch(d){return c(d)}}),a.syncTabs&&this._registerOnDataChanged(t)})}catch(i){throw l(i),i}}async getFromStorage(e,t){try{o("SvelteAdapter - getFromStorage - key:",t),this._checkStore(e);let a=await this.adapter.get(t);return a?(e.set((0,de.default)({},a)),!0):void 0}catch(a){throw l(a),a}}_checkStore(e){if(!e||typeof e.subscribe!="function"||typeof e.set!="function")throw l("Store provided is not a valid Svelte writable store"),new Error("Store provided is not a valid Svelte writable store")}},J=Ae,Ce={dbName:"storagefy",storeName:"storagefy_db",version:1,encrypt:!1,expireCheckInterval:1e3,description:"Storagefy database",adapter:"indexedDB"},_,v,E,C;function Ne(e={}){let t={...Ce,...e};if(!e.forceRecreate&&_)return _;switch(t.adapter){case"localStorage":if(e.fresh)return new Q(t);_=new Q(t);break;case"sessionStorage":if(e.fresh)return new F(t);_=new F(t);break;default:if(e.fresh)return new Z(t);_=new Z(t)}return _}function ke(){if(!_)throw new Error("Storage adapter not initialized. Call startStoragefy first.");return _}function S({adapter:e,adapterParams:t,forceRecreate:a},i,c){if(e)return new c(e);if(i&&!a)return i;if(t){let h=ee(t);return new c(h)}if(!_)throw new Error("Storage adapter not initialized. Call startStoragefy first.");return new c(_)}function ee(e){switch(e.adapter){case"localStorage":return new Q(e);case"sessionStorage":return new F(e);default:return new Z(e)}}function Te({adapter:e=null,adapterParams:t=null,forceRecreate:a=!1,fresh:i=!1}={}){return i?S({adapter:e,adapterParams:t,forceRecreate:a},null,le):(v=S({adapter:e,adapterParams:t,forceRecreate:a},v,le),{setInStorage:v.setInStorage.bind(v),getFromStorage:v.getFromStorage.bind(v)})}function ue({adapter:e=null,adapterParams:t=null,forceRecreate:a=!1,fresh:i=!1}={}){return i?S({adapter:e,adapterParams:t,forceRecreate:a},null,he):(E=S({adapter:e,adapterParams:t,forceRecreate:a},E,he),E)}function pe({adapter:e=null,adapterParams:t=null,forceRecreate:a=!1,fresh:i=!1}={}){return i?S({adapter:e,adapterParams:t,forceRecreate:a},null,J):(C=S({adapter:e,adapterParams:t,forceRecreate:a},C,J),C)}async function Ie(e,t,a={}){try{if(v||Te(),!e)throw new Error("Store is required.");if(!t)throw new Error("Key is required.");await v.getFromStorage(e,t),await v.setInStorage(e,t,a)}catch(i){throw logError(i),i}}async function ze(e,t,a={}){try{if(E||ue(),!e)throw new Error("Store is required.");if(!t)throw new Error("Key is required.");await E.getFromStorage(e,t),await E.setInStorage(e,t,a)}catch(i){throw logError(i),i}}async function qe(e,t,a={}){try{if(C||pe(),!e)throw new Error("Store is required.");if(!t)throw new Error("Key is required.");await C.getFromStorage(e,t),await C.setInStorage(e,t,a)}catch(i){throw logError(i),i}}return tt}var Nr=Er();export{Nr as d};
