import{j as y}from"./jsx-runtime.D_zvdyIk.js";import{a as O}from"./index.9MVAkNgL.js";import"./StorageAdapter.-Hf96jOd.js";import"./generateSimpleId.1pzoLIeQ.js";import"./sleep.B0B6IrN2.js";import oe from"./LocalStorageAdapter.DbWFQp1Z.js";import"./assign.MzTrJBn8.js";import{R as ce}from"./ReactAdapter.DGmXLvKE.js";const R={},Y=(e,n)=>e.unstable_is?e.unstable_is(n):n===e,Z=e=>"init"in e,U=e=>!!e.write,k=e=>"v"in e||"e"in e,M=e=>{if("e"in e)throw e.e;if((R?"production":void 0)!=="production"&&!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v},L=new WeakMap,B=e=>{var n;return q(e)&&!!((n=L.get(e))!=null&&n[0])},ae=e=>{const n=L.get(e);n?.[0]&&(n[0]=!1,n[1].forEach(r=>r()))},de=(e,n)=>{let r=L.get(e);if(!r){r=[!0,new Set],L.set(e,r);const s=()=>{r[0]=!1};e.then(s,s)}r[1].add(n)},q=e=>typeof e?.then=="function",ne=(e,n,r)=>{r.p.has(e)||(r.p.add(e),n.then(()=>{r.p.delete(e)},()=>{r.p.delete(e)}))},J=(e,n,r)=>{const s=r(e),v="v"in s,d=s.v;if(q(n))for(const u of s.d.keys())ne(e,n,r(u));s.v=n,delete s.e,(!v||!Object.is(d,s.v))&&(++s.n,q(d)&&ae(d))},F=(e,n,r)=>{var s;const v=new Set;for(const d of((s=r.get(e))==null?void 0:s.t)||[])r.has(d)&&v.add(d);for(const d of n.p)v.add(d);return v},le=()=>{const e=new Set,n=()=>{e.forEach(r=>r())};return n.add=r=>(e.add(r),()=>{e.delete(r)}),n},K=()=>{const e={},n=new WeakMap,r=s=>{var v,d;(v=n.get(e))==null||v.forEach(u=>u(s)),(d=n.get(s))==null||d.forEach(u=>u())};return r.add=(s,v)=>{const d=s||e,u=(n.has(d)?n:n.set(d,new Set)).get(d);return u.add(v),()=>{u?.delete(v),u.size||n.delete(d)}},r},fe=e=>(e.c||(e.c=K()),e.m||(e.m=K()),e.u||(e.u=K()),e.f||(e.f=le()),e),ue=Symbol(),ve=(e=new WeakMap,n=new WeakMap,r=new WeakMap,s=new Set,v=new Set,d=new Set,u={},g=(l,...p)=>l.read(...p),x=(l,...p)=>l.write(...p),S=(l,p)=>{var j;return(j=l.unstable_onInit)==null?void 0:j.call(l,p)},_=(l,p)=>{var j;return(j=l.onMount)==null?void 0:j.call(l,p)},...b)=>{const l=b[0]||(t=>{if((R?"production":void 0)!=="production"&&!t)throw new Error("Atom is undefined or null");let f=e.get(t);return f||(f={d:new Map,p:new Set,n:0},e.set(t,f),S?.(t,V)),f}),p=b[1]||(()=>{const t=[],f=a=>{try{a()}catch(o){t.push(o)}};do{u.f&&f(u.f);const a=new Set,o=a.add.bind(a);s.forEach(i=>{var c;return(c=n.get(i))==null?void 0:c.l.forEach(o)}),s.clear(),d.forEach(o),d.clear(),v.forEach(o),v.clear(),a.forEach(f),s.size&&j()}while(s.size||d.size||v.size);if(t.length)throw new AggregateError(t)}),j=b[2]||(()=>{const t=[],f=new WeakSet,a=new WeakSet,o=Array.from(s);for(;o.length;){const i=o[o.length-1],c=l(i);if(a.has(i)){o.pop();continue}if(f.has(i)){if(r.get(i)===c.n)t.push([i,c]);else if((R?"production":void 0)!=="production"&&r.has(i))throw new Error("[Bug] invalidated atom exists");a.add(i),o.pop();continue}f.add(i);for(const w of F(i,c,n))f.has(w)||o.push(w)}for(let i=t.length-1;i>=0;--i){const[c,w]=t[i];let m=!1;for(const N of w.d.keys())if(N!==c&&s.has(N)){m=!0;break}m&&(I(c),W(c)),r.delete(c)}}),I=b[3]||(t=>{var f;const a=l(t);if(k(a)&&(n.has(t)&&r.get(t)!==a.n||Array.from(a.d).every(([h,z])=>I(h).n===z)))return a;a.d.clear();let o=!0;const i=()=>{n.has(t)&&(W(t),j(),p())},c=h=>{var z;if(Y(t,h)){const X=l(h);if(!k(X))if(Z(h))J(h,h.init,l);else throw new Error("no atom init");return M(X)}const $=I(h);try{return M($)}finally{a.d.set(h,$.n),B(a.v)&&ne(t,a.v,$),(z=n.get(h))==null||z.t.add(t),o||i()}};let w,m;const N={get signal(){return w||(w=new AbortController),w.signal},get setSelf(){return(R?"production":void 0)!=="production"&&!U(t)&&console.warn("setSelf function cannot be used with read-only atom"),!m&&U(t)&&(m=(...h)=>{if((R?"production":void 0)!=="production"&&o&&console.warn("setSelf function cannot be called in sync"),!o)try{return A(t,...h)}finally{j(),p()}}),m}},T=a.n;try{const h=g(t,c,N);return J(t,h,l),q(h)&&(de(h,()=>w?.abort()),h.then(i,i)),a}catch(h){return delete a.v,a.e=h,++a.n,a}finally{o=!1,T!==a.n&&r.get(t)===T&&(r.set(t,a.n),s.add(t),(f=u.c)==null||f.call(u,t))}}),C=b[4]||(t=>{const f=[t];for(;f.length;){const a=f.pop(),o=l(a);for(const i of F(a,o,n)){const c=l(i);r.set(i,c.n),f.push(i)}}}),A=b[5]||((t,...f)=>{let a=!0;const o=c=>M(I(c)),i=(c,...w)=>{var m;const N=l(c);try{if(Y(t,c)){if(!Z(c))throw new Error("atom not writable");const T=N.n,h=w[0];J(c,h,l),W(c),T!==N.n&&(s.add(c),(m=u.c)==null||m.call(u,c),C(c));return}else return A(c,...w)}finally{a||(j(),p())}};try{return x(t,o,i,...f)}finally{a=!1}}),W=b[6]||(t=>{var f;const a=l(t),o=n.get(t);if(o&&!B(a.v)){for(const[i,c]of a.d)if(!o.d.has(i)){const w=l(i);D(i).t.add(t),o.d.add(i),c!==w.n&&(s.add(i),(f=u.c)==null||f.call(u,i),C(i))}for(const i of o.d||[])if(!a.d.has(i)){o.d.delete(i);const c=P(i);c?.t.delete(t)}}}),D=b[7]||(t=>{var f;const a=l(t);let o=n.get(t);if(!o){I(t);for(const i of a.d.keys())D(i).t.add(t);if(o={l:new Set,d:new Set(a.d.keys()),t:new Set},n.set(t,o),(f=u.m)==null||f.call(u,t),U(t)){const i=()=>{let c=!0;const w=(...m)=>{try{return A(t,...m)}finally{c||(j(),p())}};try{const m=_(t,w);m&&(o.u=()=>{c=!0;try{m()}finally{c=!1}})}finally{c=!1}};v.add(i)}}return o}),P=b[8]||(t=>{var f;const a=l(t);let o=n.get(t);if(o&&!o.l.size&&!Array.from(o.t).some(i=>{var c;return(c=n.get(i))==null?void 0:c.d.has(t)})){o.u&&d.add(o.u),o=void 0,n.delete(t),(f=u.u)==null||f.call(u,t);for(const i of a.d.keys()){const c=P(i);c?.t.delete(t)}return}return o}),ie=[e,n,r,s,v,d,u,g,x,S,_,l,p,j,I,C,A,W,D,P],V={get:t=>M(I(t)),set:(t,...f)=>{try{return A(t,...f)}finally{j(),p()}},sub:(t,f)=>{const o=D(t).l;return o.add(f),p(),()=>{o.delete(f),P(t),p()}}};return Object.defineProperty(V,ue,{value:ie}),V},re=ve,pe=fe,se={};let he=0;function Se(e,n){const r=`atom${++he}`,s={toString(){return(se?"production":void 0)!=="production"&&this.debugLabel?r+":"+this.debugLabel:r}};return typeof e=="function"?s.read=e:(s.init=e,s.read=ye,s.write=we),s}function ye(e){return e(this)}function we(e,n,r){return n(this,typeof r=="function"?r(e(this)):r)}const ge=()=>{let e=0;const n=pe({}),r=new WeakMap,s=new WeakMap,v=re(r,s,void 0,void 0,void 0,void 0,n,void 0,(g,x,S,..._)=>e?S(g,..._):g.write(x,S,..._)),d=new Set;return n.m.add(void 0,g=>{d.add(g);const x=r.get(g);x.m=s.get(g)}),n.u.add(void 0,g=>{d.delete(g);const x=r.get(g);delete x.m}),Object.assign(v,{dev4_get_internal_weak_map:()=>r,dev4_get_mounted_atoms:()=>d,dev4_restore_atoms:g=>{const x={read:()=>null,write:(S,_)=>{++e;try{for(const[b,l]of g)"init"in b&&_(b,l)}finally{--e}}};v.set(x)}})};function _e(){return(se?"production":void 0)!=="production"?ge():re()}let H=null,G=null;function be(){H=new oe({dbName:"storagefy_jotai_test",storeName:"storagefy_jotai_test_db",description:"Storagefy Jotai database",adapter:"localStorage",channelName:"storagefy_jotai_test_channel",version:1,encrypt:!1,enableSyncTabs:!0}),G=new ce(H)}be();function me(){const e=_e(),n=Se({items:[]}),r=()=>e.get(n),s=S=>{e.set(n,{...e.get(n),...S})};return{getState:r,setState:s,subscribe:S=>e.sub(n,()=>{S(e.get(n))}),addItem:S=>{const _=r(),l=_.items.find(p=>p.id===S.id)?_.items.map(p=>p.id===S.id?{...p,qty:p.qty+1}:p):[..._.items,{...S,qty:1}];s({items:l})},removeItem:S=>{const b=r().items.map(l=>l.id===S?{...l,qty:l.qty-1}:l).filter(l=>l.qty>0);s({items:b})},clear:()=>{s({items:[]})},getTotal:()=>r().items.reduce((S,_)=>S+_.price*_.qty,0)}}const E=me(),ee="React_CartStore_App";let te=!1;async function Q(){try{return te||(await G.getFromStorage(E,ee),await G.setInStorage(E,ee,{syncTabs:!0}),te=!0),{cartStore:E,loadStores:Q}}catch(e){console.error(e)}}Q();function De(){const[e,n]=O.useState({items:[]}),[r,s]=O.useState(!1),v=[{id:1,name:"Wireless Mouse",price:29.99},{id:2,name:"Mechanical Keyboard",price:79.99},{id:3,name:"USB-C Hub",price:49.99},{id:4,name:"Monitor Stand",price:39.99}];return O.useEffect(()=>{let d;return(async()=>{await Q(),n(E.getState()),d=E.subscribe(n),s(!0)})(),()=>{d&&d()}},[]),r?y.jsxs("section",{className:"shop-demo",children:[y.jsx("h2",{children:"🛍️ Mini Shop Demo"}),y.jsxs("div",{className:"store",children:[y.jsxs("div",{className:"items",children:[y.jsx("h3",{children:"🛒 Items"}),v.map(d=>y.jsxs("div",{className:"item",children:[y.jsxs("span",{children:[d.name," — $",d.price.toFixed(2)]}),y.jsx("button",{onClick:()=>E.addItem(d),children:"Add"})]},d.id))]}),y.jsxs("div",{className:"cart",children:[y.jsx("h3",{children:"🧺 Cart"}),e.items.length>0?y.jsxs(y.Fragment,{children:[e.items.map(d=>y.jsxs("div",{className:"item",children:[y.jsxs("span",{children:[d.name," × ",d.qty]}),y.jsx("button",{onClick:()=>E.removeItem(d.id),children:"Remove"})]},d.id)),y.jsx("button",{className:"clear",onClick:E.clear,children:"Clear Cart"}),y.jsxs("div",{className:"total",children:["💰 Total: $",E.getTotal().toFixed(2)]})]}):y.jsx("div",{children:"No items in cart"})]})]})]}):null}export{De as default};
