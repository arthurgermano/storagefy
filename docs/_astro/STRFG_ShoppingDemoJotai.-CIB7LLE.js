import{j as y}from"./jsx-runtime.D_zvdyIk.js";import{a as $}from"./index.9MVAkNgL.js";import{D as oe,B as ce}from"./index.DjVjF0SW.js";import"./_commonjsHelpers.Cpj98o6Y.js";const R={},Y=(e,n)=>e.unstable_is?e.unstable_is(n):n===e,Z=e=>"init"in e,U=e=>!!e.write,k=e=>"v"in e||"e"in e,M=e=>{if("e"in e)throw e.e;if((R?"production":void 0)!=="production"&&!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v},q=new WeakMap,B=e=>{var n;return L(e)&&!!((n=q.get(e))!=null&&n[0])},ae=e=>{const n=q.get(e);n?.[0]&&(n[0]=!1,n[1].forEach(r=>r()))},le=(e,n)=>{let r=q.get(e);if(!r){r=[!0,new Set],q.set(e,r);const s=()=>{r[0]=!1};e.then(s,s)}r[1].add(n)},L=e=>typeof e?.then=="function",ne=(e,n,r)=>{r.p.has(e)||(r.p.add(e),n.then(()=>{r.p.delete(e)},()=>{r.p.delete(e)}))},J=(e,n,r)=>{const s=r(e),v="v"in s,l=s.v;if(L(n))for(const u of s.d.keys())ne(e,n,r(u));s.v=n,delete s.e,(!v||!Object.is(l,s.v))&&(++s.n,L(l)&&ae(l))},F=(e,n,r)=>{var s;const v=new Set;for(const l of((s=r.get(e))==null?void 0:s.t)||[])r.has(l)&&v.add(l);for(const l of n.p)v.add(l);return v},de=()=>{const e=new Set,n=()=>{e.forEach(r=>r())};return n.add=r=>(e.add(r),()=>{e.delete(r)}),n},K=()=>{const e={},n=new WeakMap,r=s=>{var v,l;(v=n.get(e))==null||v.forEach(u=>u(s)),(l=n.get(s))==null||l.forEach(u=>u())};return r.add=(s,v)=>{const l=s||e,u=(n.has(l)?n:n.set(l,new Set)).get(l);return u.add(v),()=>{u?.delete(v),u.size||n.delete(l)}},r},fe=e=>(e.c||(e.c=K()),e.m||(e.m=K()),e.u||(e.u=K()),e.f||(e.f=de()),e),ue=Symbol(),ve=(e=new WeakMap,n=new WeakMap,r=new WeakMap,s=new Set,v=new Set,l=new Set,u={},_=(d,...h)=>d.read(...h),x=(d,...h)=>d.write(...h),S=(d,h)=>{var j;return(j=d.unstable_onInit)==null?void 0:j.call(d,h)},g=(d,h)=>{var j;return(j=d.onMount)==null?void 0:j.call(d,h)},...b)=>{const d=b[0]||(t=>{if((R?"production":void 0)!=="production"&&!t)throw new Error("Atom is undefined or null");let f=e.get(t);return f||(f={d:new Map,p:new Set,n:0},e.set(t,f),S?.(t,V)),f}),h=b[1]||(()=>{const t=[],f=a=>{try{a()}catch(o){t.push(o)}};do{u.f&&f(u.f);const a=new Set,o=a.add.bind(a);s.forEach(i=>{var c;return(c=n.get(i))==null?void 0:c.l.forEach(o)}),s.clear(),l.forEach(o),l.clear(),v.forEach(o),v.clear(),a.forEach(f),s.size&&j()}while(s.size||l.size||v.size);if(t.length)throw new AggregateError(t)}),j=b[2]||(()=>{const t=[],f=new WeakSet,a=new WeakSet,o=Array.from(s);for(;o.length;){const i=o[o.length-1],c=d(i);if(a.has(i)){o.pop();continue}if(f.has(i)){if(r.get(i)===c.n)t.push([i,c]);else if((R?"production":void 0)!=="production"&&r.has(i))throw new Error("[Bug] invalidated atom exists");a.add(i),o.pop();continue}f.add(i);for(const w of F(i,c,n))f.has(w)||o.push(w)}for(let i=t.length-1;i>=0;--i){const[c,w]=t[i];let m=!1;for(const N of w.d.keys())if(N!==c&&s.has(N)){m=!0;break}m&&(I(c),D(c)),r.delete(c)}}),I=b[3]||(t=>{var f;const a=d(t);if(k(a)&&(n.has(t)&&r.get(t)!==a.n||Array.from(a.d).every(([p,z])=>I(p).n===z)))return a;a.d.clear();let o=!0;const i=()=>{n.has(t)&&(D(t),j(),h())},c=p=>{var z;if(Y(t,p)){const X=d(p);if(!k(X))if(Z(p))J(p,p.init,d);else throw new Error("no atom init");return M(X)}const O=I(p);try{return M(O)}finally{a.d.set(p,O.n),B(a.v)&&ne(t,a.v,O),(z=n.get(p))==null||z.t.add(t),o||i()}};let w,m;const N={get signal(){return w||(w=new AbortController),w.signal},get setSelf(){return(R?"production":void 0)!=="production"&&!U(t)&&console.warn("setSelf function cannot be used with read-only atom"),!m&&U(t)&&(m=(...p)=>{if((R?"production":void 0)!=="production"&&o&&console.warn("setSelf function cannot be called in sync"),!o)try{return A(t,...p)}finally{j(),h()}}),m}},T=a.n;try{const p=_(t,c,N);return J(t,p,d),L(p)&&(le(p,()=>w?.abort()),p.then(i,i)),a}catch(p){return delete a.v,a.e=p,++a.n,a}finally{o=!1,T!==a.n&&r.get(t)===T&&(r.set(t,a.n),s.add(t),(f=u.c)==null||f.call(u,t))}}),C=b[4]||(t=>{const f=[t];for(;f.length;){const a=f.pop(),o=d(a);for(const i of F(a,o,n)){const c=d(i);r.set(i,c.n),f.push(i)}}}),A=b[5]||((t,...f)=>{let a=!0;const o=c=>M(I(c)),i=(c,...w)=>{var m;const N=d(c);try{if(Y(t,c)){if(!Z(c))throw new Error("atom not writable");const T=N.n,p=w[0];J(c,p,d),D(c),T!==N.n&&(s.add(c),(m=u.c)==null||m.call(u,c),C(c));return}else return A(c,...w)}finally{a||(j(),h())}};try{return x(t,o,i,...f)}finally{a=!1}}),D=b[6]||(t=>{var f;const a=d(t),o=n.get(t);if(o&&!B(a.v)){for(const[i,c]of a.d)if(!o.d.has(i)){const w=d(i);W(i).t.add(t),o.d.add(i),c!==w.n&&(s.add(i),(f=u.c)==null||f.call(u,i),C(i))}for(const i of o.d||[])if(!a.d.has(i)){o.d.delete(i);const c=P(i);c?.t.delete(t)}}}),W=b[7]||(t=>{var f;const a=d(t);let o=n.get(t);if(!o){I(t);for(const i of a.d.keys())W(i).t.add(t);if(o={l:new Set,d:new Set(a.d.keys()),t:new Set},n.set(t,o),(f=u.m)==null||f.call(u,t),U(t)){const i=()=>{let c=!0;const w=(...m)=>{try{return A(t,...m)}finally{c||(j(),h())}};try{const m=g(t,w);m&&(o.u=()=>{c=!0;try{m()}finally{c=!1}})}finally{c=!1}};v.add(i)}}return o}),P=b[8]||(t=>{var f;const a=d(t);let o=n.get(t);if(o&&!o.l.size&&!Array.from(o.t).some(i=>{var c;return(c=n.get(i))==null?void 0:c.d.has(t)})){o.u&&l.add(o.u),o=void 0,n.delete(t),(f=u.u)==null||f.call(u,t);for(const i of a.d.keys()){const c=P(i);c?.t.delete(t)}return}return o}),ie=[e,n,r,s,v,l,u,_,x,S,g,d,h,j,I,C,A,D,W,P],V={get:t=>M(I(t)),set:(t,...f)=>{try{return A(t,...f)}finally{j(),h()}},sub:(t,f)=>{const o=W(t).l;return o.add(f),h(),()=>{o.delete(f),P(t),h()}}};return Object.defineProperty(V,ue,{value:ie}),V},re=ve,he=fe,se={};let pe=0;function Se(e,n){const r=`atom${++pe}`,s={toString(){return(se?"production":void 0)!=="production"&&this.debugLabel?r+":"+this.debugLabel:r}};return typeof e=="function"?s.read=e:(s.init=e,s.read=ye,s.write=we),s}function ye(e){return e(this)}function we(e,n,r){return n(this,typeof r=="function"?r(e(this)):r)}const _e=()=>{let e=0;const n=he({}),r=new WeakMap,s=new WeakMap,v=re(r,s,void 0,void 0,void 0,void 0,n,void 0,(_,x,S,...g)=>e?S(_,...g):_.write(x,S,...g)),l=new Set;return n.m.add(void 0,_=>{l.add(_);const x=r.get(_);x.m=s.get(_)}),n.u.add(void 0,_=>{l.delete(_);const x=r.get(_);delete x.m}),Object.assign(v,{dev4_get_internal_weak_map:()=>r,dev4_get_mounted_atoms:()=>l,dev4_restore_atoms:_=>{const x={read:()=>null,write:(S,g)=>{++e;try{for(const[b,d]of _)"init"in b&&g(b,d)}finally{--e}}};v.set(x)}})};function ge(){return(se?"production":void 0)!=="production"?_e():re()}let H=null,G=null;function be(){H=new oe({dbName:"storagefy_jotai_test",storeName:"storagefy_jotai_test_db",description:"Storagefy Jotai database",adapter:"localStorage",channelName:"storagefy_jotai_test_channel",version:1,encrypt:!1,enableSyncTabs:!0}),G=new ce(H)}be();function me(){const e=ge(),n=Se({items:[]}),r=()=>e.get(n),s=S=>{e.set(n,{...e.get(n),...S})};return{getState:r,setState:s,subscribe:S=>e.sub(n,()=>{S(e.get(n))}),addItem:S=>{const g=r(),d=g.items.find(h=>h.id===S.id)?g.items.map(h=>h.id===S.id?{...h,qty:h.qty+1}:h):[...g.items,{...S,qty:1}];s({items:d})},removeItem:S=>{const b=r().items.map(d=>d.id===S?{...d,qty:d.qty-1}:d).filter(d=>d.qty>0);s({items:b})},clear:()=>{s({items:[]})},getTotal:()=>r().items.reduce((S,g)=>S+g.price*g.qty,0)}}const E=me(),ee="React_CartStore_App";let te=!1;async function Q(){try{return te||(await G.getFromStorage(E,ee),await G.setInStorage(E,ee,{syncTabs:!0}),te=!0),{cartStore:E,loadStores:Q}}catch(e){console.error(e)}}Q();function Ne(){const[e,n]=$.useState({items:[]}),[r,s]=$.useState(!1),v=[{id:1,name:"Wireless Mouse",price:29.99},{id:2,name:"Mechanical Keyboard",price:79.99},{id:3,name:"USB-C Hub",price:49.99},{id:4,name:"Monitor Stand",price:39.99}];return $.useEffect(()=>{let l;return(async()=>{await Q(),n(E.getState()),l=E.subscribe(n),s(!0)})(),()=>{l&&l()}},[]),r?y.jsxs("section",{className:"shop-demo",children:[y.jsx("h2",{children:"ðŸ›ï¸ Mini Shop Demo"}),y.jsxs("div",{className:"store",children:[y.jsxs("div",{className:"items",children:[y.jsx("h3",{children:"ðŸ›’ Items"}),v.map(l=>y.jsxs("div",{className:"item",children:[y.jsxs("span",{children:[l.name," â€” $",l.price.toFixed(2)]}),y.jsx("button",{onClick:()=>E.addItem(l),children:"Add"})]},l.id))]}),y.jsxs("div",{className:"cart",children:[y.jsx("h3",{children:"ðŸ§º Cart"}),e.items.length>0?y.jsxs(y.Fragment,{children:[e.items.map(l=>y.jsxs("div",{className:"item",children:[y.jsxs("span",{children:[l.name," Ã— ",l.qty]}),y.jsx("button",{onClick:()=>E.removeItem(l.id),children:"Remove"})]},l.id)),y.jsx("button",{className:"clear",onClick:E.clear,children:"Clear Cart"}),y.jsxs("div",{className:"total",children:["ðŸ’° Total: $",E.getTotal().toFixed(2)]})]}):y.jsx("div",{children:"No items in cart"})]})]})]}):null}export{Ne as default};
